import { useState, useEffect, useRef, useCallback } from "react"
import {
  Stack,
  Text,
  Panel,
  IStackTokens,
  IconButton,
  IStackStyles,
  DefaultPalette,
  ThemeProvider,
  PartialTheme,
  PanelType,
  IButtonStyles,
  IPanelProps,
  MessageBar,
  IRenderFunction,
  ITextStyles,
  IPanelStyles,
  TooltipHost,
  IMessageBarStyles,
  MessageBarType,
  Icon,
  mergeStyleSets,
  registerIcons,
  DefaultButton,
} from "@fluentui/react"
import { AxiosResponse } from "axios"
import { useBoolean } from "@fluentui/react-hooks"
import { SSHModal } from "./SSHModal"
import { ClusterDetailPanel } from "./ClusterDetail"
import { ClusterList } from "./ClusterList"
import { fetchInfo, fetchRegions, ProcessLogOut } from "./Request"
import { RegionComponent } from "./RegionList"

const containerStackTokens: IStackTokens = {}
const appStackTokens: IStackTokens = { childrenGap: 10 }

const errorBarStyles: Partial<IMessageBarStyles> = { root: { marginBottom: 15 } }

export interface ICluster {
  key: string
  name: string
  subscription: string
  resourceGroup: string
  id: string
  version: string
  createdDate: string
  provisionedBy: string
  provisioningState: string
  failedProvisioningState: string
  resourceId: string
  consoleLink: string
}

const stackStyles: IStackStyles = {
  root: [
    {
      width: "100%",
      padding: 0,
    },
  ],
}

const headerTextStyles: ITextStyles = {
  root: {
    fontWeight: 600,
  },
}

export const contentStackStylesNormal: IStackStyles = {
  root: [
    {
      padding: 20,
    },
  ],
}

const stackNavStyles: IStackStyles = {
  root: {
    padding: "0px 15px",
    height: 40,
  },
}

const MenuButtonStyles: IButtonStyles = {
  root: {
    color: DefaultPalette.white,
  },
  rootHovered: {
    color: DefaultPalette.themePrimary,
  },
}

const v1ButtonStyle: IButtonStyles = {
  root: {
    backgroundColor: "transparent",
    color: DefaultPalette.white,
    minWidth: "50px",
    height: "20px",
    marginLeft: "10px",
    padding: "0px",
    borderColor: DefaultPalette.white,
  },
  rootHovered: {
    backgroundColor: DefaultPalette.white,
    color: DefaultPalette.themePrimary,
  },
}

const darkTheme: PartialTheme = {
  semanticColors: {
    bodyBackground: DefaultPalette.themePrimary,
    bodyText: DefaultPalette.white,
  },
}

const navPanelStyles: Partial<IPanelStyles> = {
  navigation: {
    height: 40,
    lineHeight: 40,
    fontSize: 15,
    paddingLeft: 15,
    justifyContent: "start",
    alignItems: "center",
  },
}

export const headerStyles = mergeStyleSets({
  titleText: {
    fontWeight: 600,
    fontSize: 24,
    lineHeight: 32,
  },
  subtitleText: {
    color: "#646464",
    fontSize: 12,
    lineHeight: 14,
    margin: 0,
  },
})

registerIcons({
  icons: {
    "openshift-svg": (
      <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 64 64">
        <g>
          <path d="M17.424 27.158L7.8 30.664c.123 1.545.4 3.07.764 4.566l9.15-3.333c-.297-1.547-.403-3.142-.28-4.74M60 16.504c-.672-1.386-1.45-2.726-2.35-3.988l-9.632 3.506c1.12 1.147 2.06 2.435 2.83 3.813z" />
          <path d="M38.802 13.776c2.004.935 3.74 2.21 5.204 3.707l9.633-3.506a27.38 27.38 0 0 0-10.756-8.95c-13.77-6.42-30.198-.442-36.62 13.326a27.38 27.38 0 0 0-2.488 13.771l9.634-3.505c.16-2.087.67-4.18 1.603-6.184 4.173-8.947 14.844-12.83 23.79-8.658" />
        </g>
        <path d="M9.153 35.01L0 38.342c.84 3.337 2.3 6.508 4.304 9.33l9.612-3.5a17.99 17.99 0 0 1-4.763-9.164" />
        <path d="M49.074 31.38a17.64 17.64 0 0 1-1.616 6.186c-4.173 8.947-14.843 12.83-23.79 8.657a17.71 17.71 0 0 1-5.215-3.7l-9.612 3.5c2.662 3.744 6.293 6.874 10.748 8.953 13.77 6.42 30.196.44 36.618-13.328a27.28 27.28 0 0 0 2.479-13.765l-9.61 3.498z" />
        <path d="M51.445 19.618l-9.153 3.332c1.7 3.046 2.503 6.553 2.24 10.08l9.612-3.497c-.275-3.45-1.195-6.817-2.7-9.915" />
      </svg>
    ),
    "kubernetes-svg": (
      <svg
        id="svg"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        width="22"
        height="22"
        style={{ overflow: "visible" }}>
        <g id="svgg" transform="translate(0.000000,18.000000) scale(0.05000000,-0.05000000)">
          <path
            id="path0"
            d="M184.496 1.550 L 184.496 3.101 175.239 3.101 L 165.982 3.101 165.748 3.973 C 165.620 4.453,165.512 5.848,165.509 7.074 L 165.504 9.302 159.915 9.302 C 152.738 9.302,153.101 9.125,153.101 12.638 L 153.101 15.504 147.512 15.504 C 140.335 15.504,140.698 15.326,140.698 18.840 L 140.698 21.705 136.879 21.705 C 134.778 21.705,131.987 21.817,130.677 21.954 L 128.295 22.203 128.295 25.249 L 128.295 28.295 122.134 28.295 C 115.088 28.295,115.504 28.062,115.504 31.999 L 115.504 34.476 109.399 34.583 L 103.295 34.690 103.182 37.684 L 103.069 40.678 96.980 40.785 L 90.891 40.891 90.778 43.886 L 90.665 46.880 84.577 46.986 L 78.488 47.093 78.375 50.097 L 78.262 53.101 72.284 53.101 C 65.357 53.101,65.504 53.017,65.504 56.951 L 65.504 59.302 59.915 59.302 C 52.738 59.302,53.101 59.125,53.101 62.638 L 53.101 65.504 48.110 65.504 C 45.366 65.504,42.575 65.613,41.909 65.746 L 40.698 65.988 40.698 69.041 L 40.698 72.093 37.597 72.093 L 34.496 72.093 34.496 78.295 L 34.496 84.496 31.395 84.496 L 28.295 84.496 28.295 96.883 L 28.295 109.270 25.291 109.383 L 22.287 109.496 22.025 111.240 C 21.881 112.200,21.750 117.825,21.734 123.740 L 21.705 134.496 18.840 134.496 C 15.193 134.496,15.504 133.001,15.504 150.553 L 15.504 165.384 12.500 165.735 L 9.496 166.085 9.394 178.375 L 9.291 190.665 6.293 190.778 L 3.295 190.891 3.192 203.198 L 3.090 215.504 1.545 215.504 L 0.000 215.504 0.000 237.403 L 0.000 259.302 1.534 259.302 L 3.068 259.302 3.181 262.306 L 3.295 265.310 6.298 265.423 L 9.302 265.536 9.302 268.350 C 9.302 271.849,9.535 272.093,12.868 272.093 L 15.504 272.093 15.504 277.545 C 15.504 284.429,15.537 284.496,18.966 284.496 L 21.625 284.496 21.899 287.597 L 22.174 290.698 25.234 290.698 L 28.295 290.698 28.295 293.798 L 28.295 296.899 31.395 296.899 L 34.496 296.899 34.496 300.000 L 34.496 303.101 37.597 303.101 L 40.698 303.101 40.698 309.261 C 40.698 316.309,40.464 315.891,44.412 315.891 L 46.899 315.891 46.899 318.757 C 46.899 322.087,46.906 322.093,50.613 322.093 L 53.101 322.093 53.101 324.959 C 53.101 328.288,53.108 328.295,56.815 328.295 L 59.302 328.295 59.302 330.930 C 59.302 334.233,59.565 334.496,62.868 334.496 L 65.504 334.496 65.509 339.826 C 65.517 347.216,65.369 346.899,68.803 346.899 L 71.625 346.899 71.899 350.000 L 72.174 353.101 75.234 353.101 L 78.295 353.101 78.295 356.202 L 78.295 359.302 81.395 359.302 L 84.496 359.302 84.496 362.362 C 84.496 365.908,84.478 365.891,88.200 365.891 L 90.678 365.891 90.785 371.996 L 90.891 378.101 93.879 378.214 L 96.867 378.327 96.980 381.314 L 97.093 384.302 100.097 384.416 L 103.101 384.529 103.101 386.063 L 103.101 387.597 196.899 387.597 L 290.698 387.597 290.698 386.056 L 290.698 384.516 296.802 384.409 L 302.907 384.302 303.014 378.214 L 303.120 372.125 306.114 372.012 L 309.109 371.899 309.221 368.911 L 309.334 365.924 312.322 365.811 L 315.310 365.698 315.423 362.500 L 315.535 359.302 318.620 359.302 L 321.705 359.302 321.705 356.217 L 321.705 353.132 324.903 353.020 L 328.101 352.907 328.207 346.818 L 328.314 340.730 331.308 340.617 L 334.302 340.504 334.415 337.516 L 334.528 334.528 337.516 334.415 L 340.504 334.302 340.617 331.314 L 340.730 328.327 343.718 328.214 L 346.705 328.101 346.818 325.113 L 346.931 322.125 349.919 322.012 L 352.907 321.899 353.013 315.601 L 353.120 309.302 356.211 309.302 L 359.302 309.302 359.302 306.202 L 359.302 303.101 362.403 303.101 L 365.504 303.101 365.504 300.000 L 365.504 296.899 368.605 296.899 L 371.705 296.899 371.705 293.814 L 371.705 290.729 374.903 290.616 L 378.101 290.504 378.214 287.516 L 378.327 284.528 381.314 284.415 L 384.302 284.302 384.409 278.214 L 384.516 272.125 387.510 272.012 L 390.504 271.899 390.616 268.718 L 390.729 265.536 393.717 265.423 L 396.705 265.310 396.819 262.306 L 396.932 259.302 398.466 259.302 L 400.000 259.302 400.000 240.698 L 400.000 222.093 398.455 222.093 L 396.910 222.093 396.808 209.593 L 396.705 197.093 393.706 196.980 L 390.707 196.867 390.605 181.476 L 390.504 166.085 387.500 165.735 L 384.496 165.384 384.496 153.654 C 384.496 139.584,384.783 140.698,381.160 140.698 L 378.295 140.698 378.295 128.511 C 378.295 114.699,378.627 115.846,374.549 115.584 L 371.705 115.402 371.705 99.949 L 371.705 84.496 368.605 84.496 L 365.504 84.496 365.504 78.295 L 365.504 72.093 362.403 72.093 L 359.302 72.093 359.302 69.041 L 359.302 65.988 358.091 65.746 C 357.425 65.613,354.634 65.504,351.890 65.504 L 346.899 65.504 346.899 62.638 C 346.899 59.125,347.262 59.302,340.085 59.302 L 334.496 59.302 334.496 56.667 C 334.496 53.048,334.598 53.101,327.652 53.101 L 321.738 53.101 321.625 50.097 L 321.512 47.093 315.423 46.986 L 309.335 46.880 309.222 43.886 L 309.109 40.891 303.020 40.785 L 296.931 40.678 296.818 37.684 L 296.705 34.690 290.601 34.583 L 284.496 34.476 284.496 31.999 C 284.496 28.062,284.912 28.295,277.866 28.295 L 271.705 28.295 271.705 25.249 L 271.705 22.203 269.323 21.954 C 268.013 21.817,265.222 21.705,263.121 21.705 L 259.302 21.705 259.302 18.840 C 259.302 15.326,259.665 15.504,252.488 15.504 L 246.899 15.504 246.899 12.638 C 246.899 9.053,247.639 9.302,236.984 9.302 L 228.295 9.302 228.295 6.667 C 228.295 3.047,228.398 3.101,221.434 3.101 L 215.504 3.101 215.504 1.550 L 215.504 0.000 200.000 0.000 L 184.496 0.000 184.496 1.550 M209.383 18.508 L 209.496 21.512 215.548 21.618 L 221.601 21.725 221.944 24.913 L 222.287 28.101 231.492 28.205 L 240.698 28.309 240.698 31.167 C 240.698 34.672,240.337 34.496,247.512 34.496 L 253.101 34.496 253.101 37.362 C 253.101 40.875,252.738 40.698,259.915 40.698 L 265.504 40.698 265.509 42.926 C 265.519 47.162,265.080 46.899,272.138 46.899 L 278.295 46.899 278.295 50.000 L 278.295 53.101 284.496 53.101 L 290.698 53.101 290.698 56.202 L 290.698 59.302 296.883 59.302 L 303.068 59.302 303.181 62.306 L 303.295 65.310 309.399 65.417 L 315.504 65.524 315.504 68.001 C 315.504 71.938,315.088 71.705,322.134 71.705 L 328.295 71.705 328.295 74.765 C 328.295 78.501,327.896 78.295,335.109 78.295 L 340.698 78.295 340.698 81.160 C 340.698 84.488,340.707 84.496,344.395 84.496 L 346.867 84.496 346.980 87.500 L 347.093 90.504 350.097 90.617 L 353.101 90.730 353.101 105.947 C 353.101 123.288,352.837 122.093,356.667 122.093 L 359.302 122.093 359.302 133.883 C 359.302 148.020,359.015 146.899,362.638 146.899 L 365.504 146.899 365.504 158.746 C 365.504 172.738,365.335 172.093,369.006 172.093 L 371.705 172.093 371.705 185.214 C 371.705 192.431,371.817 199.408,371.954 200.718 L 372.203 203.101 375.249 203.101 L 378.295 203.101 378.295 215.462 C 378.295 229.527,377.938 228.295,382.008 228.295 L 384.496 228.295 384.496 240.698 L 384.496 253.101 382.008 253.101 C 378.302 253.101,378.295 253.107,378.295 256.437 L 378.295 259.302 376.405 259.302 C 372.269 259.302,372.174 259.377,371.872 262.835 L 371.605 265.891 368.790 265.891 C 365.335 265.891,365.504 265.541,365.504 272.690 L 365.504 278.262 362.500 278.375 L 359.496 278.488 359.383 281.476 L 359.270 284.464 356.282 284.577 L 353.295 284.690 353.182 287.678 L 353.069 290.666 350.081 290.779 L 347.093 290.891 346.980 293.879 L 346.867 296.867 343.879 296.980 L 340.891 297.093 340.778 300.097 L 340.665 303.101 338.194 303.101 C 334.265 303.101,334.496 302.686,334.496 309.731 L 334.496 315.891 331.395 315.891 L 328.295 315.891 328.295 318.992 L 328.295 322.093 325.234 322.093 L 322.174 322.093 321.899 325.194 L 321.625 328.295 318.800 328.295 C 315.515 328.295,315.504 328.307,315.504 332.008 L 315.504 334.496 312.638 334.496 C 309.125 334.496,309.302 334.134,309.302 341.311 L 309.302 346.899 306.815 346.899 C 303.108 346.899,303.101 346.906,303.101 350.235 L 303.101 353.101 300.872 353.106 C 296.946 353.115,296.899 353.154,296.899 356.400 L 296.899 359.222 293.798 359.496 L 290.698 359.771 290.698 362.831 L 290.698 365.891 287.597 365.891 L 284.496 365.891 284.496 368.992 L 284.496 372.093 196.899 372.093 L 109.302 372.093 109.302 365.932 L 109.302 359.771 106.202 359.496 L 103.101 359.222 103.101 356.400 C 103.101 353.154,103.054 353.115,99.128 353.106 L 96.899 353.101 96.899 350.235 C 96.899 346.906,96.892 346.899,93.185 346.899 L 90.698 346.899 90.698 344.412 C 90.698 340.705,90.691 340.698,87.362 340.698 L 84.496 340.698 84.496 335.109 C 84.496 327.932,84.674 328.295,81.160 328.295 L 78.295 328.295 78.295 325.807 C 78.295 322.074,78.313 322.093,74.765 322.093 L 71.705 322.093 71.705 318.992 L 71.705 315.891 68.605 315.891 L 65.504 315.891 65.504 312.839 L 65.504 309.787 64.293 309.545 C 63.626 309.411,62.236 309.302,61.202 309.302 L 59.322 309.302 59.215 303.198 L 59.109 297.093 56.121 296.980 L 53.133 296.867 53.020 293.879 L 52.907 290.891 49.919 290.779 L 46.931 290.666 46.818 287.678 L 46.705 284.690 43.718 284.577 L 40.730 284.464 40.617 281.476 L 40.504 278.488 37.510 278.375 L 34.516 278.262 34.409 272.174 L 34.302 266.085 31.298 265.972 L 28.295 265.859 28.295 262.991 C 28.295 259.615,28.304 259.624,24.549 259.383 L 21.705 259.200 21.705 256.386 C 21.705 253.113,21.691 253.101,17.992 253.101 L 15.504 253.101 15.504 237.613 L 15.504 222.126 18.508 222.012 L 21.512 221.899 21.614 209.415 L 21.716 196.930 24.908 196.818 L 28.101 196.705 28.203 184.415 L 28.305 172.125 31.304 172.012 L 34.302 171.899 34.404 156.315 L 34.505 140.730 37.504 140.617 L 40.504 140.504 40.606 128.020 L 40.708 115.536 43.707 115.423 L 46.705 115.310 46.808 103.020 L 46.910 90.730 49.909 90.617 L 52.907 90.504 53.020 87.516 L 53.133 84.528 56.121 84.415 L 59.109 84.302 59.222 81.308 L 59.335 78.314 65.423 78.207 L 71.512 78.101 71.624 74.913 L 71.736 71.724 78.019 71.618 L 84.302 71.512 84.415 68.518 L 84.528 65.523 90.617 65.417 L 96.705 65.310 96.819 62.306 L 96.932 59.302 103.117 59.302 L 109.302 59.302 109.302 56.202 L 109.302 53.101 115.504 53.101 L 121.705 53.101 121.705 50.010 L 121.705 46.918 128.004 46.812 L 134.302 46.705 134.415 43.711 L 134.528 40.717 140.617 40.611 L 146.705 40.504 146.818 37.510 L 146.931 34.516 153.020 34.409 L 159.109 34.302 159.222 31.308 L 159.335 28.314 165.423 28.207 L 171.512 28.101 171.624 24.910 L 171.737 21.719 181.120 21.615 L 190.504 21.512 190.617 18.508 L 190.730 15.504 200.000 15.504 L 209.270 15.504 209.383 18.508 M190.963 40.949 C 190.817 41.095,190.698 42.486,190.698 44.041 L 190.698 46.867 187.694 46.980 L 184.690 47.093 184.589 65.795 L 184.489 84.496 175.232 84.496 C 164.682 84.496,165.504 84.183,165.504 88.203 L 165.504 90.684 156.298 90.788 L 147.093 90.891 146.980 93.879 L 146.867 96.867 143.879 96.980 L 140.891 97.093 140.778 100.087 L 140.665 103.081 134.577 103.188 L 128.488 103.295 128.375 106.298 L 128.262 109.302 118.798 109.302 L 109.335 109.302 109.222 106.298 L 109.109 103.295 106.121 103.182 L 103.133 103.069 103.020 100.081 L 102.907 97.093 90.698 97.093 L 78.488 97.093 78.375 100.081 L 78.263 103.069 75.275 103.182 L 72.287 103.295 72.025 105.039 C 71.690 107.268,71.694 117.422,72.030 119.961 L 72.287 121.899 75.291 122.012 L 78.295 122.126 78.295 124.975 C 78.295 128.286,78.304 128.295,82.008 128.295 L 84.496 128.295 84.496 131.160 C 84.496 134.674,84.134 134.496,91.311 134.496 L 96.899 134.496 96.899 140.681 L 96.899 146.867 93.895 146.980 L 90.891 147.093 90.788 156.259 L 90.684 165.424 87.590 165.698 L 84.496 165.972 84.496 187.637 L 84.496 209.302 82.008 209.302 C 78.302 209.302,78.295 209.309,78.295 212.638 L 78.295 215.504 67.539 215.533 C 61.623 215.548,55.998 215.679,55.039 215.823 L 53.295 216.085 53.181 219.089 L 53.068 222.093 49.977 222.093 L 46.885 222.093 46.989 231.298 L 47.093 240.504 50.081 240.617 L 53.069 240.730 53.182 243.718 L 53.295 246.705 71.996 246.806 L 90.698 246.907 90.698 250.004 L 90.698 253.101 93.782 253.101 L 96.867 253.101 96.980 256.105 L 97.093 259.109 100.097 259.222 L 103.101 259.335 103.101 265.249 C 103.101 272.194,103.048 272.093,106.667 272.093 L 109.302 272.093 109.302 274.729 C 109.302 278.032,109.565 278.295,112.868 278.295 L 115.504 278.295 115.504 280.646 C 115.504 284.180,115.788 284.496,118.966 284.496 L 121.625 284.496 121.899 287.597 L 122.174 290.698 125.234 290.698 L 128.295 290.698 128.295 303.295 L 128.295 315.891 125.249 315.891 L 122.203 315.891 121.954 318.274 C 121.632 321.358,121.632 335.231,121.954 338.315 L 122.203 340.698 125.249 340.698 L 128.295 340.698 128.295 343.805 L 128.295 346.913 137.500 346.809 L 146.705 346.705 146.818 343.718 L 146.931 340.730 149.919 340.617 L 152.907 340.504 153.014 334.415 L 153.120 328.327 156.114 328.214 L 159.109 328.101 159.215 321.996 L 159.322 315.891 200.003 315.891 L 240.684 315.891 240.788 325.097 L 240.891 334.302 243.879 334.415 L 246.867 334.528 246.980 337.516 L 247.093 340.504 250.081 340.617 L 253.069 340.730 253.182 343.718 L 253.295 346.705 262.500 346.809 L 271.705 346.913 271.705 343.821 L 271.705 340.729 274.903 340.616 L 278.101 340.504 278.209 329.070 C 278.346 314.698,278.655 315.891,274.799 315.891 L 271.705 315.891 271.705 312.839 L 271.705 309.787 270.494 309.545 C 269.828 309.411,268.433 309.302,267.393 309.302 L 265.504 309.302 265.504 303.101 L 265.504 296.899 268.605 296.899 L 271.705 296.899 271.705 293.814 L 271.705 290.729 274.903 290.616 L 278.101 290.504 278.214 287.516 L 278.327 284.528 281.314 284.415 L 284.302 284.302 284.415 281.314 L 284.528 278.327 287.516 278.214 L 290.504 278.101 290.617 275.113 L 290.730 272.125 293.718 272.012 L 296.705 271.899 296.812 265.617 L 296.918 259.335 299.913 259.222 L 302.907 259.109 303.014 253.007 L 303.120 246.906 324.913 246.806 L 346.705 246.705 346.818 243.718 L 346.931 240.730 349.919 240.617 L 352.907 240.504 353.011 231.298 L 353.115 222.093 350.023 222.093 L 346.932 222.093 346.819 219.089 L 346.705 216.085 344.961 215.823 C 344.002 215.679,338.377 215.548,332.461 215.533 L 321.705 215.504 321.705 212.638 C 321.705 209.309,321.698 209.302,317.992 209.302 L 315.504 209.302 315.504 187.637 L 315.504 165.972 312.413 165.699 L 309.322 165.425 309.215 159.360 L 309.109 153.295 306.105 153.181 L 303.101 153.068 303.101 143.792 L 303.101 134.516 309.205 134.409 L 315.310 134.302 315.423 131.314 L 315.536 128.327 318.524 128.214 L 321.512 128.101 321.625 125.112 L 321.737 122.124 324.919 122.012 L 328.101 121.899 328.205 113.033 C 328.328 102.620,328.503 103.101,324.581 103.101 L 321.738 103.101 321.625 100.097 L 321.512 97.093 309.302 97.093 L 297.093 97.093 296.980 100.081 L 296.867 103.069 293.879 103.182 L 290.891 103.295 290.778 106.298 L 290.665 109.302 278.101 109.302 L 265.536 109.302 265.423 106.298 L 265.310 103.295 262.322 103.182 L 259.334 103.069 259.221 100.081 L 259.109 97.093 253.020 96.986 L 246.931 96.880 246.818 93.886 L 246.705 90.891 240.601 90.785 L 234.496 90.678 234.496 88.200 C 234.496 84.183,235.318 84.496,224.768 84.496 L 215.511 84.496 215.411 65.795 L 215.310 47.093 212.322 46.980 L 209.334 46.867 209.221 43.879 L 209.109 40.891 200.168 40.788 C 195.251 40.730,191.109 40.803,190.963 40.949 M228.295 100.000 L 228.295 103.101 234.496 103.101 L 240.698 103.101 240.698 106.202 L 240.698 109.302 246.883 109.302 L 253.068 109.302 253.181 112.306 L 253.295 115.310 256.298 115.423 L 259.302 115.536 259.302 118.350 C 259.302 122.158,259.188 122.093,265.909 122.093 L 271.586 122.093 271.936 125.097 L 272.287 128.101 275.281 128.214 L 278.275 128.327 278.382 134.415 L 278.488 140.504 281.476 140.617 L 284.464 140.730 284.577 143.718 L 284.690 146.705 287.694 146.819 L 290.698 146.932 290.698 153.117 L 290.698 159.302 293.798 159.302 L 296.899 159.302 296.899 165.462 C 296.899 172.510,296.666 172.093,300.613 172.093 L 303.101 172.093 303.101 197.093 L 303.101 222.093 300.000 222.093 L 296.899 222.093 296.899 231.379 L 296.899 240.665 293.895 240.778 L 290.891 240.891 290.785 246.996 L 290.678 253.101 288.200 253.101 C 284.264 253.101,284.496 252.685,284.496 259.731 L 284.496 265.891 281.395 265.891 L 278.295 265.891 278.295 268.992 L 278.295 272.093 275.234 272.093 L 272.174 272.093 271.899 275.194 L 271.625 278.295 268.800 278.295 C 265.516 278.295,265.504 278.309,265.504 281.999 L 265.504 284.476 259.399 284.583 L 253.295 284.690 253.182 287.678 L 253.069 290.666 250.081 290.779 L 247.093 290.891 246.980 293.888 L 246.867 296.885 237.678 296.989 L 228.488 297.093 228.375 300.097 L 228.262 303.101 200.000 303.101 L 171.738 303.101 171.625 300.097 L 171.512 297.093 165.423 296.986 L 159.335 296.880 159.222 293.886 L 159.109 290.891 156.121 290.779 L 153.133 290.666 153.020 287.678 L 152.907 284.690 143.702 284.586 L 134.496 284.482 134.496 282.001 C 134.496 278.302,134.489 278.295,131.160 278.295 L 128.295 278.295 128.295 275.807 C 128.295 272.074,128.313 272.093,124.765 272.093 L 121.705 272.093 121.705 268.992 L 121.705 265.891 118.605 265.891 L 115.504 265.891 115.504 259.731 C 115.504 252.686,115.735 253.101,111.806 253.101 L 109.335 253.101 109.222 250.097 L 109.109 247.093 106.105 246.980 L 103.101 246.867 103.101 234.480 L 103.101 222.093 100.000 222.093 L 96.899 222.093 96.899 197.109 L 96.899 172.126 99.903 172.012 L 102.907 171.899 103.011 162.516 L 103.114 153.133 106.112 153.020 L 109.109 152.907 109.221 149.919 L 109.334 146.931 112.322 146.818 L 115.310 146.705 115.423 143.718 L 115.536 140.730 118.524 140.617 L 121.512 140.504 121.618 134.415 L 121.725 128.326 124.913 128.213 L 128.101 128.101 128.214 125.113 L 128.327 122.125 131.314 122.012 L 134.302 121.899 134.415 118.711 L 134.527 115.523 140.616 115.417 L 146.705 115.310 146.818 112.322 L 146.931 109.334 149.919 109.221 L 152.907 109.109 153.020 106.105 L 153.133 103.101 162.419 103.101 L 171.705 103.101 171.705 100.000 L 171.705 96.899 200.000 96.899 L 228.295 96.899 228.295 100.000 M178.779 109.559 C 178.453 109.691,178.295 110.692,178.295 112.629 L 178.295 115.504 169.793 115.504 C 159.032 115.504,159.302 115.409,159.302 119.176 L 159.302 122.093 153.101 122.093 L 146.899 122.093 146.899 125.194 L 146.899 128.295 143.791 128.295 L 140.684 128.295 140.788 137.500 L 140.891 146.705 143.879 146.818 L 146.867 146.931 146.980 149.919 L 147.093 152.907 150.081 153.020 L 153.069 153.133 153.182 156.121 L 153.295 159.109 159.399 159.215 L 165.504 159.322 165.510 161.928 C 165.519 165.813,164.476 165.529,178.321 165.413 L 190.504 165.310 190.603 137.834 C 190.676 117.858,190.583 110.213,190.265 109.830 C 189.832 109.308,179.977 109.075,178.779 109.559 M209.735 109.830 C 209.417 110.213,209.324 117.858,209.397 137.834 L 209.496 165.310 221.899 165.310 L 234.302 165.310 234.415 162.322 L 234.528 159.334 237.516 159.221 L 240.504 159.109 240.617 156.114 L 240.730 153.120 246.818 153.014 L 252.907 152.907 253.020 149.919 L 253.133 146.931 256.121 146.818 L 259.109 146.705 259.212 137.500 L 259.316 128.295 253.124 128.295 L 246.932 128.295 246.819 125.291 L 246.705 122.287 243.702 122.174 L 240.698 122.060 240.698 119.160 C 240.698 115.412,240.962 115.504,230.207 115.504 L 221.705 115.504 221.705 112.638 C 221.705 110.383,221.575 109.723,221.092 109.538 C 219.780 109.034,210.190 109.281,209.735 109.830 M122.342 153.399 C 122.241 153.563,122.033 154.959,121.881 156.500 L 121.605 159.302 119.164 159.302 C 115.388 159.302,115.504 158.984,115.504 169.391 L 115.504 178.262 112.500 178.375 L 109.496 178.488 109.496 193.798 L 109.496 209.109 125.000 209.109 L 140.504 209.109 140.617 206.112 L 140.730 203.115 149.919 203.011 L 159.109 202.907 159.221 199.919 L 159.334 196.931 162.322 196.818 L 165.310 196.705 165.417 190.601 L 165.524 184.496 162.413 184.496 L 159.302 184.496 159.302 181.395 L 159.302 178.295 156.202 178.295 L 153.101 178.295 153.101 175.194 L 153.101 172.093 150.016 172.093 L 146.932 172.093 146.819 169.089 L 146.705 166.085 143.702 165.735 L 140.698 165.384 140.698 162.744 C 140.698 159.589,140.377 159.302,136.847 159.302 L 134.496 159.302 134.496 156.667 C 134.496 155.134,134.302 153.836,134.031 153.566 C 133.506 153.041,122.659 152.887,122.342 153.399 M265.905 153.850 C 265.684 154.263,265.504 155.658,265.504 156.951 L 265.504 159.302 263.153 159.302 C 259.623 159.302,259.302 159.589,259.302 162.744 L 259.302 165.384 256.298 165.735 L 253.295 166.085 253.181 169.089 L 253.068 172.093 249.984 172.093 L 246.899 172.093 246.899 175.194 L 246.899 178.295 240.691 178.295 L 234.482 178.295 234.586 187.500 L 234.690 196.705 237.678 196.818 L 240.666 196.931 240.779 199.919 L 240.891 202.907 250.081 203.011 L 259.270 203.115 259.383 206.112 L 259.496 209.109 275.000 209.109 L 290.504 209.109 290.504 196.899 L 290.504 184.690 287.500 184.577 L 284.496 184.464 284.496 172.284 C 284.496 158.298,284.794 159.302,280.646 159.302 L 278.295 159.302 278.295 156.667 C 278.295 153.069,278.352 153.101,271.835 153.101 C 266.766 153.101,266.273 153.163,265.905 153.850 M184.496 200.000 L 184.496 215.504 200.000 215.504 L 215.504 215.504 215.504 200.000 L 215.504 184.496 200.000 184.496 L 184.496 184.496 184.496 200.000 M121.899 225.194 L 121.625 228.295 118.800 228.295 C 115.365 228.295,115.502 228.046,115.509 234.237 C 115.517 240.951,115.386 240.698,118.844 240.698 L 121.705 240.698 121.705 244.517 C 121.705 246.617,121.817 249.408,121.954 250.718 L 122.203 253.101 125.249 253.101 L 128.295 253.101 128.295 256.202 L 128.295 259.302 131.395 259.302 L 134.496 259.302 134.496 262.403 L 134.496 265.504 137.597 265.504 L 140.698 265.504 140.698 268.563 C 140.698 272.111,140.679 272.093,144.412 272.093 L 146.899 272.093 146.899 274.993 C 146.899 278.516,146.578 278.368,153.876 278.212 L 159.109 278.101 159.212 268.702 L 159.316 259.302 162.410 259.302 L 165.504 259.302 165.504 253.101 L 165.504 246.899 168.605 246.899 L 171.705 246.899 171.705 234.496 L 171.705 222.093 146.940 222.093 L 122.174 222.093 121.899 225.194 M228.295 234.496 L 228.295 246.899 231.395 246.899 L 234.496 246.899 234.496 256.202 L 234.496 265.504 237.597 265.504 L 240.698 265.504 240.698 271.698 C 240.698 279.044,239.982 278.376,247.674 278.212 L 252.907 278.101 253.020 275.113 L 253.133 272.125 256.121 272.012 L 259.109 271.899 259.221 268.702 L 259.334 265.504 262.419 265.504 L 265.504 265.504 265.504 262.403 L 265.504 259.302 268.605 259.302 L 271.705 259.302 271.705 256.217 L 271.705 253.132 274.903 253.020 L 278.101 252.907 278.207 246.818 L 278.314 240.730 281.308 240.617 L 284.302 240.504 284.414 235.271 C 284.570 227.973,284.718 228.295,281.194 228.295 L 278.295 228.295 278.295 225.807 C 278.295 224.439,278.189 223.043,278.059 222.706 C 277.848 222.156,275.284 222.093,253.059 222.093 L 228.295 222.093 228.295 234.496 M190.966 234.745 C 190.818 234.892,190.698 237.680,190.698 240.940 L 190.698 246.867 187.694 246.980 L 184.690 247.093 184.583 253.198 L 184.476 259.302 182.597 259.302 C 181.563 259.302,180.172 259.411,179.506 259.545 L 178.295 259.787 178.295 262.839 L 178.295 265.891 175.249 265.891 L 172.203 265.891 171.954 268.274 C 171.637 271.306,171.682 280.273,172.025 282.558 L 172.287 284.302 175.275 284.415 L 178.263 284.528 178.375 287.516 L 178.488 290.504 200.000 290.504 L 221.512 290.504 221.625 287.515 L 221.737 284.527 224.919 284.415 L 228.101 284.302 228.212 279.070 C 228.369 271.730,228.547 272.093,224.799 272.093 L 221.705 272.093 221.705 265.940 L 221.705 259.787 220.494 259.545 C 219.828 259.411,218.437 259.302,217.403 259.302 L 215.524 259.302 215.417 253.198 L 215.310 247.093 212.322 246.980 L 209.334 246.867 209.221 243.879 L 209.109 240.891 206.121 240.779 L 203.133 240.666 203.020 237.678 L 202.907 234.690 197.070 234.583 C 193.860 234.525,191.113 234.597,190.966 234.745 "
            stroke="none"
            fill="#047cd4"
            fillRule="evenodd"
          />
          <path id="path1" d="" stroke="none" fill="#087cd4" fillRule="evenodd" />
          <path id="path2" d="" stroke="none" fill="#087cd4" fillRule="evenodd" />
          <path id="path3" d="" stroke="none" fill="#087cd4" fillRule="evenodd" />
          <path id="path4" d="" stroke="none" fill="#087cd4" fillRule="evenodd" />
        </g>
      </svg>
    ),
  },
})

export interface IClusterDetail {
  subscription: string
  resourceGroup: string
  clusterName: string
}

function App(props: { params: any }) {
  const [data, updateData] = useState({ location: "", csrf: "", elevated: false, username: "" })
  const [regions, setRegions] = useState<any>([])
  const [error, setError] = useState<AxiosResponse | null>(null)
  const [isOpen, { setTrue: openPanel, setFalse: dismissPanel }] = useBoolean(false)
  const [fetching, setFetching] = useState("")
  const [currentCluster, setCurrentCluster] = useState<ICluster | null>(null)

  const [contentStackStyles, setContentStackStyles] =
    useState<IStackStyles>(contentStackStylesNormal)
  const sshRef = useRef<typeof SSHModal | null>(null)
  const csrfRef = useRef<string>("")

  const _onCloseDetailPanel = () => {
    setCurrentCluster(null)
    setContentStackStyles(contentStackStylesNormal)
  }

  useEffect(() => {
    const onData = (result: AxiosResponse | null) => {
      if (result?.status === 200) {
        updateData(result.data)
        csrfRef.current = result.data.csrf
      } else {
        setError(result)
      }
      setFetching("DONE")
    }

    const onRegions = (result: AxiosResponse | null) => {
      if (result?.status === 200) {
        setRegions(result.data)
      } else {
        setError(result)
      }
    }

    if (fetching === "") {
      setFetching("FETCHING")
      fetchInfo().then(onData)
      fetchRegions().then(onRegions)
    }
  }, [fetching, error, data, regions])

  const onRenderNavigationContent: IRenderFunction<IPanelProps> = useCallback(
    () => (
      <>
        <IconButton iconProps={{ iconName: "GlobalNavButton" }} onClick={dismissPanel} />
      </>
    ),
    [dismissPanel]
  )

  const logOut = () => {
    ProcessLogOut()
  }

  const errorBar = (): any => {
    console.log(error)
    return (
      <MessageBar
        messageBarType={MessageBarType.error}
        isMultiline={false}
        onDismiss={() => setError(null)}
        dismissButtonAriaLabel="Close"
        styles={errorBarStyles}>
        {error?.statusText}
      </MessageBar>
    )
  }

  // Application state maintains the current resource id/name/group
  // when we click a thing set the state
  // ...

  return (
    <>
      <Stack styles={stackStyles} tokens={containerStackTokens} horizontalAlign={"stretch"}>
        <Panel
          id="RegionsPanel"
          isLightDismiss
          styles={navPanelStyles}
          type={PanelType.smallFixedNear}
          isOpen={isOpen}
          onDismiss={dismissPanel}
          closeButtonAriaLabel="Close"
          onRenderNavigationContent={onRenderNavigationContent}>
          <RegionComponent item={regions} />
        </Panel>
        <ThemeProvider theme={darkTheme}>
          <Stack
            grow
            tokens={appStackTokens}
            horizontalAlign={"start"}
            verticalAlign={"center"}
            horizontal
            styles={stackNavStyles}>
            <Stack.Item>
              <IconButton
                id="RegionNavButton"
                iconProps={{ iconName: "GlobalNavButton" }}
                onClick={openPanel}
                styles={MenuButtonStyles}
              />
            </Stack.Item>
            <Stack.Item grow>
              <Text styles={headerTextStyles}>
                ARO Portal {data.location ? "(" + data.location + ")" : ""}
              </Text>
            </Stack.Item>
            <Stack.Item>
              <Text>{data.username}</Text>
            </Stack.Item>

            <Stack.Item hidden={!data.elevated}>
              <TooltipHost content={`Elevated User`}>
                <Icon iconName={"Admin"}></Icon>
              </TooltipHost>
            </Stack.Item>
            <Stack.Item>
              <DefaultButton styles={v1ButtonStyle} title="Go to Admin Portal V1" href="/v1">
                V1
              </DefaultButton>
            </Stack.Item>
            <Stack.Item>
              <IconButton
                iconProps={{ iconName: "SignOut" }}
                onClick={logOut}
                styles={MenuButtonStyles}
              />
            </Stack.Item>
          </Stack>
        </ThemeProvider>
        <Stack styles={contentStackStyles}>
          <Stack.Item grow>{error && errorBar()}</Stack.Item>
          <Stack.Item grow>
            <ClusterList
              csrfToken={csrfRef}
              sshBox={sshRef}
              setCurrentCluster={setCurrentCluster}
              csrfTokenAvailable={fetching}
              params={props.params}
            />
          </Stack.Item>
          <Stack.Item grow>
            <ClusterDetailPanel
              csrfToken={csrfRef}
              loaded={fetching}
              currentCluster={currentCluster}
              onClose={_onCloseDetailPanel}
            />
          </Stack.Item>
        </Stack>
        <SSHModal csrfToken={csrfRef} ref={sshRef} />
      </Stack>
    </>
  )
}

export default App
