(this["webpackJsonparo-rp"]=this["webpackJsonparo-rp"]||[]).push([[0],{156:function(e,t,n){"use strict";n.r(t);var a=n(54),r=n.n(a),s=n(15),o=n(0),c=n(3),i=n(236),l=n(229),u=n(8),d=n(227),j=n(230),b=n(18),h=n(222),p=n(233),m=n(223),O=n(108),f=n(198),x=n(29),g=n.n(x),v=n(40),y=n(199),k=n(219),S=n(226),C=n(224),w=n(228),T=n(41),N=n.n(T),I=n(4),R={iconName:"Cancel"},H={iconName:"Copy"},P=[{key:1,text:"master-1"},{key:2,text:"master-2"},{key:3,text:"master-3"}],A=Object(c.C)(),L=Object(c.F)({container:{display:"flex",flexFlow:"column nowrap",alignItems:"stretch"},header:[{flex:"1 1 auto",borderTop:"4px solid ".concat(A.palette.themePrimary),color:A.palette.neutralPrimary,display:"flex",alignItems:"center",fontSize:c.e.xLargePlus,fontWeight:c.f.semibold,padding:"12px 12px 14px 24px"}],body:{flex:"4 4 auto",padding:"0 24px 24px 24px",overflowY:"hidden",selectors:{p:{margin:"14px 0"},"p:first-child":{marginTop:0},"p:last-child":{marginBottom:0}}}}),B={root:{color:A.palette.neutralPrimary,marginLeft:"auto",marginTop:"4px",marginRight:"2px"},rootHovered:{color:A.palette.neutralDark}},D=Object(o.forwardRef)((function(e,t){var n=e.csrfToken,a=Object(f.a)(!1),r=Object(s.a)(a,2),c=r[0],j=r[1],b=j.setTrue,h=j.setFalse,p=Object(y.a)("title"),m=Object(f.a)(!1),O=Object(s.a)(m,2),x=O[0],T=O[1],A=T.setTrue,D=T.setFalse,E=Object(o.useState)(""),F=Object(s.a)(E,2),z=F[0],_=F[1],W=Object(o.useState)(),M=Object(s.a)(W,2),G=M[0],K=M[1],U=Object(f.a)(!1),q=Object(s.a)(U,2),J=q[0],X=q[1],Z=X.setTrue,V=X.setFalse,Y=Object(o.useState)(),Q=Object(s.a)(Y,2),$=Q[0],ee=Q[1],te=Object(o.useState)(null),ne=Object(s.a)(te,2),ae=ne[0],re=ne[1];Object(o.useImperativeHandle)(t,(function(){return{LoadSSH:function(e){V(),ee(null),re(null),b(),_(e)}}})),Object(o.useEffect)((function(){function e(){return(e=Object(v.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,re(null),e.next=4,N()({method:"post",url:z+"/ssh/new",data:{master:null===G||void 0===G?void 0:G.key},headers:{"X-CSRF-Token":n.current}});case 4:t=e.sent,ee(t.data),Z(),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),Z(),re(e.t0.response);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}x&&G&&(D(),function(){e.apply(this,arguments)}())}),[z,G,n,x,D,Z]);var se=function(e,t){K(t),Z()};return Object(I.jsx)("div",{children:Object(I.jsxs)(C.a,{titleAriaId:p,isOpen:c,onDismiss:h,isModeless:!0,containerClassName:L.container,children:[Object(I.jsxs)("div",{className:L.header,children:[Object(I.jsx)("span",{id:p,children:"SSH Access"}),Object(I.jsx)(i.a,{styles:B,iconProps:R,ariaLabel:"Close popup modal",onClick:h})]}),Object(I.jsxs)("div",{className:L.body,children:[Object(I.jsxs)("p",{children:["Before requesting SSH access, please ensure you have read the"," ",Object(I.jsx)("a",{href:"https://msazure.visualstudio.com/AzureRedHatOpenShift/_wiki/wikis/ARO.wiki/136823/ARO-SRE-portal?anchor=ssh-(elevated)",children:"SSH docs"}),"."]}),ae&&Object(I.jsx)(l.a,{messageBarType:u.a.error,isMultiline:!1,onDismiss:function(){return re(null)},dismissButtonAriaLabel:"Close",children:null===ae||void 0===ae?void 0:ae.statusText}),$?Object(I.jsx)("div",{children:Object(I.jsxs)(d.a,{children:[Object(I.jsxs)(d.a,{horizontal:!0,verticalAlign:"end",children:[Object(I.jsx)(d.a.Item,{grow:!0,children:Object(I.jsx)(S.a,{label:"Command",value:null===$||void 0===$?void 0:$.command,readOnly:!0})}),Object(I.jsx)(d.a.Item,{children:Object(I.jsx)(i.a,{iconProps:H,ariaLabel:"Copy command",onClick:function(e){$&&navigator.clipboard.writeText($.command)}})})]}),Object(I.jsxs)(d.a,{horizontal:!0,verticalAlign:"end",children:[Object(I.jsxs)(d.a.Item,{grow:!0,children:[Object(I.jsx)(S.a,{label:"Password",value:null===$||void 0===$?void 0:$.password,type:"password",canRevealPassword:!0,readOnly:!0})," "]}),Object(I.jsx)(d.a.Item,{children:Object(I.jsx)(i.a,{iconProps:H,ariaLabel:"Copy password",onClick:function(e){$&&navigator.clipboard.writeText($.password)}})})]})]})}):Object(I.jsxs)(d.a,{tokens:{childrenGap:15},children:[Object(I.jsx)(k.a,{label:"Machine Selection",onChange:se,options:P}),Object(I.jsx)(w.a,{onClick:A,text:"Request",disabled:!J})]})]})]})})})),E=n(103),F=n(104),z=n(109),_=n(107),W=n(220),M=n(234),G=n(218),K=n(30),U=n(10),q=function(e){return 403===e.status?(document.location.href="/api/login",null):e},J=function(){var e=Object(v.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N()("/api/clusters");case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),n=e.t0.response,e.abrupt("return",q(n));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=Object(v.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N()("/api/info");case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),n=e.t0.response,e.abrupt("return",q(n));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=Object(v.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N()({method:"POST",url:"/api/logout"});case 3:return t=e.sent,e.abrupt("return",t);case 7:e.prev=7,e.t0=e.catch(0),n=e.t0.response,console.log(n);case 11:document.location.href="/api/login";case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(v.a)(g.a.mark((function e(t,n){var a,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N()({method:"POST",url:n+"/kubeconfig/new",headers:{"X-CSRF-Token":t}});case 3:return a=e.sent,e.abrupt("return",a);case 7:return e.prev=7,e.t0=e.catch(0),r=e.t0.response,e.abrupt("return",q(r));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),Y=n(105),Q=Object(o.forwardRef)((function(e,t){var n=e.csrfToken,a=e.clusterID,r=Object(o.useState)({name:"",content:""}),c=Object(s.a)(r,2),l=c[0],u=c[1],d=Object(o.useState)(null),j=Object(s.a)(d,2),b=j[0],h=j[1],p=Object(o.useState)("DONE"),O=Object(s.a)(p,2),f=O[0],x=O[1],g=Object(o.useRef)(null);return Object(o.useEffect)((function(){""===f&&(x("FETCHING"),V(n.current,a).then((function(e){if(200===(null===e||void 0===e?void 0:e.status)){var t=new Blob([e.request.response]),n=URL.createObjectURL(t),a=Object(Y.parse)(e.headers["content-disposition"]).parameters.filename;u({content:n,name:a})}else h(e);x("DONE")})))}),[f,b,l,a,n]),Object(o.useLayoutEffect)((function(){l.content&&g&&g.current&&(g.current.href=l.content,g.current.download=l.name,g.current.click(),URL.revokeObjectURL(l.content),l.content="")}),[l]),Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)(m.a,{content:"Download Kubeconfig",children:[Object(I.jsx)(i.a,{iconProps:{iconName:"HardDriveGroup"},disabled:"FETCHING"===f,"aria-label":"Download Kubeconfig",onClick:function(e){return x("")}}),Object(I.jsx)("a",{style:{display:"none"},ref:g,href:"#",children:"dl"})]})})})),$={root:{marginBottom:15}},ee=Object(c.F)({controlWrapper:{display:"flex",flexWrap:"wrap"},fullWidth:{width:"100%"},fileIconImg:{verticalAlign:"middle",maxHeight:"20px",maxWidth:"20px"},headerIcon:{height:18,paddingTop:1},iconContainer:{margin:"-11px 0px",height:42},controlButtonContainer:{paddingLeft:0},titleText:{fontWeight:600,fontSize:24,lineHeight:32},subtitleText:{color:"#646464",fontSize:12,lineHeight:14,margin:0},itemsCount:{padding:"10px 0px"}}),te={root:{paddingLeft:0}},ne={root:{fontSize:0,marginBottom:20,padding:0}},ae={headerWrapper:{marginTop:"-16px"}},re=function(e){Object(z.a)(n,e);var t=Object(_.a)(n);function n(e){var a;Object(E.a)(this,n),(a=t.call(this,e))._sshModal=void 0,a._onChangeText=function(e,t){a.setState({items:t?a.props.items.filter((function(e){return e.name.toLowerCase().indexOf(t)>-1})):a.props.items})},a._onColumnClick=function(e,t){var n=a.state,r=n.columns,s=n.items,o=r.slice(),c=o.filter((function(e){return t.key===e.key}))[0];o.forEach((function(e){e===c?(c.isSortedDescending=!c.isSortedDescending,c.isSorted=!0):(e.isSorted=!1,e.isSortedDescending=!0)})),a.setState({columns:o,items:s})},a._sshModal=e.sshModalRef;var r=[{key:"icon",name:"",fieldName:"",minWidth:24,isRowHeader:!1,data:"string",isPadded:!1,maxWidth:24,onRender:function(e){return Object(I.jsx)(d.a,{horizontal:!0,verticalAlign:"center",className:ee.iconContainer,children:Object(I.jsx)("img",{src:"/favicon.ico",className:ee.headerIcon,alt:""})})}},{key:"name",name:"Name",fieldName:"name",minWidth:210,isRowHeader:!0,isResizable:!0,isSorted:!0,isSortedDescending:!1,sortAscendingAriaLabel:"Sorted A to Z",sortDescendingAriaLabel:"Sorted Z to A",onColumnClick:a._onColumnClick,data:"string",isPadded:!0},{key:"icons",name:"",fieldName:"icons",minWidth:92,isRowHeader:!1,data:"string",isPadded:!0,onRender:function(t){return Object(I.jsxs)(d.a,{horizontal:!0,verticalAlign:"center",className:ee.iconContainer,children:[Object(I.jsx)(m.a,{content:"Prometheus",children:Object(I.jsx)(i.a,{iconProps:{iconName:"BarChart4"},"aria-label":"Prometheus",href:t.name+"/prometheus"})}),Object(I.jsx)(m.a,{content:"SSH",children:Object(I.jsx)(i.a,{iconProps:{iconName:"CommandPrompt"},"aria-label":"SSH",onClick:function(e){return a._onSSHClick(t)}})}),Object(I.jsx)(Q,{clusterID:t.name,csrfToken:e.csrfToken})]})}}];return a.state={items:a.props.items,columns:r,modalOpen:!1},a}return Object(F.a)(n,[{key:"render",value:function(){var e=this.state,t=e.columns,n=e.items;return Object(I.jsxs)(d.a,{children:[Object(I.jsx)("div",{className:ee.controlWrapper,children:Object(I.jsx)(S.a,{placeholder:"Filter on any field",onChange:this._onChangeText})}),Object(I.jsxs)(p.a,{className:ee.itemsCount,children:["Showing ",n.length," items"]}),Object(I.jsx)(G.a,{items:n,columns:t,selectionMode:K.b.none,getKey:this._getKey,setKey:"none",layoutMode:U.e.justified,isHeaderVisible:!0,onItemInvoked:this._onItemInvoked,styles:ae})]})}},{key:"_getKey",value:function(e,t){return e.key}},{key:"_onSSHClick",value:function(e){var t=this._sshModal;t&&t.current&&t.current.LoadSSH(e.name)}},{key:"_onItemInvoked",value:function(e){alert("Item invoked: ".concat(e.name))}}]),n}(o.Component);function se(e){var t=Object(o.useState)([]),n=Object(s.a)(t,2),a=n[0],r=n[1],c=Object(o.useState)(null),i=Object(s.a)(c,2),j=i[0],b=i[1],h=Object(o.useRef)(null),p=Object(o.useState)(""),m=Object(s.a)(p,2),O=m[0],f=m[1],x=function(e){r(e),h&&h.current&&h.current.setState({items:e})};Object(o.useEffect)((function(){""===O&&"DONE"===e.loaded&&(f("FETCHING"),J().then((function(e){200===(null===e||void 0===e?void 0:e.status)?x(e.data):b(e),f("DONE")})))}),[a,O,f,e.loaded]);var g=[{key:"refresh",text:"Refresh",iconProps:{iconName:"Refresh"},onClick:function(){x([]),f("")}}];return Object(I.jsxs)(d.a,{children:[Object(I.jsx)("span",{className:ee.titleText,children:"Clusters"}),Object(I.jsx)("span",{className:ee.subtitleText,children:"Azure Red Hat OpenShift"}),Object(I.jsx)(W.a,{items:g,ariaLabel:"Use left and right arrow keys to navigate between commands",className:ee.controlButtonContainer,styles:te}),Object(I.jsx)(M.a,{styles:ne}),j&&Object(I.jsx)(l.a,{messageBarType:u.a.error,isMultiline:!1,onDismiss:function(){return b(null)},dismissButtonAriaLabel:"Close",styles:$,children:null===j||void 0===j?void 0:j.statusText}),Object(I.jsx)(re,{items:a,ref:h,sshModalRef:e.sshBox,csrfToken:e.csrfToken})]})}var oe={},ce={childrenGap:10},ie={root:{marginBottom:15}},le={root:[{width:"100%",padding:0}]},ue={root:{fontWeight:600}},de={root:[{padding:20}]},je={root:{padding:"0px 15px",height:40}},be={icon:{color:c.d.white}},he={semanticColors:{bodyBackground:c.d.themePrimary,bodyText:c.d.white}},pe={navigation:{height:40,lineHeight:40,fontSize:15,paddingLeft:15,justifyContent:"start",alignItems:"center"}};var me=function(){var e=Object(o.useState)({location:"",csrf:"",elevated:!1,username:""}),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)(null),c=Object(s.a)(r,2),x=c[0],g=c[1],v=Object(f.a)(!1),y=Object(s.a)(v,2),k=y[0],S=y[1],C=S.setTrue,w=S.setFalse,T=Object(o.useState)(""),N=Object(s.a)(T,2),R=N[0],H=N[1],P=Object(o.useRef)(null),A=Object(o.useRef)("");Object(o.useEffect)((function(){""===R&&(H("FETCHING"),X().then((function(e){200===(null===e||void 0===e?void 0:e.status)?(a(e.data),A.current=e.data.csrf):g(e),H("DONE")})))}),[R,x,n]);var L=Object(o.useCallback)((function(e,t){return Object(I.jsx)(I.Fragment,{children:Object(I.jsx)(i.a,{iconProps:{iconName:"GlobalNavButton"},onClick:w})})}),[w]);return Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)(d.a,{styles:le,tokens:oe,horizontalAlign:"stretch",children:[Object(I.jsx)(j.a,{isLightDismiss:!0,styles:pe,type:b.a.smallFixedNear,isOpen:k,onDismiss:w,closeButtonAriaLabel:"Close",onRenderNavigationContent:L,children:Object(I.jsx)("p",{children:"regions go here"})}),Object(I.jsx)(h.a,{theme:he,children:Object(I.jsxs)(d.a,{grow:!0,tokens:ce,horizontalAlign:"start",verticalAlign:"center",horizontal:!0,styles:je,children:[Object(I.jsx)(d.a.Item,{children:Object(I.jsx)(i.a,{iconProps:{iconName:"GlobalNavButton"},onClick:C,styles:be})}),Object(I.jsx)(d.a.Item,{grow:!0,children:Object(I.jsxs)(p.a,{styles:ue,children:["ARO Portal ",n.location?"("+n.location+")":""]})}),Object(I.jsx)(d.a.Item,{children:Object(I.jsx)(p.a,{children:n.username})}),Object(I.jsx)(d.a.Item,{hidden:!n.elevated,children:Object(I.jsx)(m.a,{content:"Elevated User",children:Object(I.jsx)(O.a,{iconName:"Admin"})})}),Object(I.jsx)(d.a.Item,{children:Object(I.jsx)(i.a,{iconProps:{iconName:"SignOut"},onClick:function(){Z()},styles:be})})]})}),Object(I.jsxs)(d.a,{styles:de,children:[Object(I.jsx)(d.a.Item,{grow:!0,children:x&&(console.log(x),Object(I.jsx)(l.a,{messageBarType:u.a.error,isMultiline:!1,onDismiss:function(){return g(null)},dismissButtonAriaLabel:"Close",styles:ie,children:null===x||void 0===x?void 0:x.statusText}))}),Object(I.jsx)(d.a.Item,{grow:!0,children:Object(I.jsx)(se,{csrfToken:A,sshBox:P,loaded:R})})]}),Object(I.jsx)(D,{csrfToken:A,ref:P})]})})},Oe=n(106);Object(Oe.a)(),Object(c.G)({":global(body,html,#root)":{margin:0,padding:0,height:"100vh"}}),r.a.render(Object(I.jsx)(me,{}),document.getElementById("root"))}},[[156,1,2]]]);
//# sourceMappingURL=main.a1e4906a.chunk.js.map