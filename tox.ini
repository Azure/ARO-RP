[tox]
envlist = lint,cilinter,py36-unittest
setupdir = python/az/aro

[testenv]
skip_install = true
download = true
whitelist_externals =
    mkdir
    echo

[testenv:py{36,37,38}-unittest]
skip_install = false
deps = azdev
    azure-cli
    https://github.com/Azure/azure-cli/archive/master.zip#subdirectory=src/azure-cli-testsdk
commands = python -m unittest discover -s azext_aro

[testenv:clilinter]
basepython = python3.6
deps = {[testenv:py36-unittest]deps}
setenv =
    AZDEV_CONFIG_DIR = {toxworkdir}/azconfig

commands =
    mkdir -p azconfig
    echo "[extension]\ndev_sources = {toxinidir}/python\n[cloud]\nname = AzureCloud" > azconfig/config
    azdev linter -o table

[testenv:lint]
basepython = python3.6
deps =
    flake8
    flake8-bugbear
commands = flake8 python/az/aro

[testenv:format-yaml]
deps = ruamel.yaml
commands =
    python hack/format-yaml/format-yaml.py .pipelines

[testenv:wheel]
deps = wheel
changedir = python/az/aro
commands = python setup.py bdist_wheel

[flake8]
skip_install = true
max-line-length = 120
exclude =
    build
