# No PR triggers to run it manually
pr: none
trigger: none

stages:
  - stage: Deploy_INT
    dependsOn: []
    displayName: ðŸš€ Deploy INT
    jobs:
    - template: ./templates/template-job-deploy-azure-env.yml
      parameters:
        environment: RP-INT
        locations:
        - eastus
        configFileName: int-config.yaml
        azureDevOpsJSONSPN: $(aro-v4-ci-devops-spn)
        vsoProjectID: $(vso-project-id)
        vsoConfigPipelineID: $(vso-config-pipeline-id)
        vsoDeployerPipelineID: $(vso-deployer-pipeline-id)
        azureDevOpsE2EJSONSPN: $(aro-v4-e2e-devops-spn)
        e2eSubscription: $(e2e-subscription)
  - stage: Billing_E2E
    displayName: Billing E2E
    jobs:
    - job: TriggerBillingBuild
      displayName: 'Trigger Billing E2E pipeline'
      steps:
      - task: TriggerBuild@3
        inputs:
          definitionIsInCurrentTeamProject: true
          buildDefinition: 'Billing - E2E'
          queueBuildForUserThatTriggeredBuild: true
          ignoreSslCertificateErrors: false
          useSameSourceVersion: false
          useCustomSourceVersion: false
          useSameBranch: true
          waitForQueuedBuildsToFinish: true
          storeInEnvironmentVariable: false
          authenticationMethod: 'OAuth Token'
          password: '$(System.AccessToken)'
          enableBuildInQueueCondition: false
          dependentOnSuccessfulBuildCondition: true
          dependentOnFailedBuildCondition: true
          checkbuildsoncurrentbranch: false
          failTaskIfConditionsAreNotFulfilled: true
