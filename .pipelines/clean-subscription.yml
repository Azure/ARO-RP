trigger: none
pr: none

parameters:
- name: purgeTTL
- name: subscriptionId
- name: purgeCreatedTag
- name: subscriptionCredentials
- name: resourceGroupDeletePrefixes
- name: dryRun
  type: boolean
  default: true

variables:
- template: vars.yml

jobs:
- job: Clean subscription
  pool:
    vmImage: ubuntu-latest

  steps:
  - template: ./templates/template-setup-golang-env.yml
    parameters:
      gobin: ${{ variables.GOBIN }}
      gopath: ${{ variables.GOPATH }}
      goroot: ${{ variables.GOROOT }}
      modulePath: ${{ variables.modulePath }}

  - template: ./templates/template-clean-subscription.yml
    parameters:
      dryRun: ${{ parameters.dryRun }}
      subscriptionCredentials: ${{ parameters.subscriptionCredentials }}
      subscriptionId: ${{ parameters.subscriptionId }}
      purgeTTL: ${{ parameters.purgeTTL }}
      purgeCreatedTag:  ${{ parameters.purgeCreatedTag }}
      resourceGroupDeletePrefixes: ${{ parameters.resourceGroupDeletePrefixes }}
      workingDirectory: ${{ variables.modulePath }}

