parameters:
  workingDirectory: ''
steps:
- script: |
    set -e
    set -o pipefail

    cd ${{ parameters.workingDirectory }}

    . secrets/env

    set -x
    . ./hack/e2e/run-rp-and-e2e.sh

    export DATABASE_NAME=v4-e2e-V$BUILD_BUILDID

    if [ $RP_MODE = "development" ]
    then
      run_rp
      validate_rp_running
      register_sub
    fi

    run_e2e

    if [ $RP_MODE = "development" ]
    then
      kill_rp
    fi
  displayName: ðŸš€ Run ARO RP & E2E
