parameters:
  workingDirectory: ''
steps:
- script: |
    set -e
    set -o pipefail

    cd ${{ parameters.workingDirectory }}
    export BUILD_ID=${{ parameters.buildID }}

    . secrets/env
    . ./hack/e2e/run-rp-and-e2e.sh

    export DATABASE_NAME=v4-e2e-V$(git log --format=%h -n 1 HEAD)

    if [ $RP_MODE = "development" ]
    then
      run_rp
      validate_rp_running
      register_sub
    fi

    run_e2e

    if [ $RP_MODE = "development" ]
    then
      kill_rp
    fi
  displayName: ðŸš€ Run ARO RP & E2E
