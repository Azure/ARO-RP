parameters:
  secretSA: ""

steps:
  - script: |
    # Export the SECRET_SA_ACCOUNT_NAME environment variable and run make secrets
    export SECRET_SA_ACCOUNT_NAME=${{ parameters.secretSA }} && make secrets

    # Define the expected directory and file names
    expected_dir="secrets"
    files=("env" "dev-ca.crt" "dev-client.crt")

    # Validate that the secrets directory and required files exist
    [ -d "$expected_dir" ] || { echo "Directory '$expected_dir' has not been created."; exit 1; }
    for file in "${files[@]}"; do
      [ -f "$expected_dir/$file" ] || { echo "File '$file' does not exist inside the directory '$expected_dir'."; exit 1; }
    done
    name: download-secrets
    displayName: ðŸ”‘ Downloading certificates and secrets from storage account
