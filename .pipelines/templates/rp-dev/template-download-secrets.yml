parameters:
  secretSA: ""

steps:
  - script: |
      # Export the SECRET_SA_ACCOUNT_NAME environment variable
      export SECRET_SA_ACCOUNT_NAME=${{ parameters.secretSA }}
      # Run the make secrets command
      make secrets

      # Define the expected directory and file names
      expected_dir="secrets"
      expected_env_file="env"
      expected_cert_file="dev-ca.crt"
      expected_dev_cert_file="dev-client.crt"

      # Validate that the secrets directory was created and the required files exist
      [ -d "$expected_dir" ] || { echo "Directory '$expected_dir' has not been created."; exit 1; }
      [ -f "$expected_dir/$expected_env_file" ] || { echo "Env file '$expected_env_file' does not exist inside the directory '$expected_dir'."; exit 1; }
      [ -f "$expected_dir/$expected_cert_file" ] || { echo "Cert file '$expected_cert_file' does not exist inside the directory '$expected_dir'."; exit 1; }
      [ -f "$expected_dir/$expected_dev_cert_file" ] || { echo "Cert file '$expected_dev_cert_file' does not exist inside the directory '$expected_dir'."; exit 1; }
    name: download-secrets
    displayName: ðŸ”‘ Downloading certificates and secrets from storage account
