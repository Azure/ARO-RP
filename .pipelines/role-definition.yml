trigger: none
pr: none

resources:
  pipelines:
    - pipeline: role-definition
      source: \Public Cloud ARO pipelines\CI\CI
      trigger: true
  containers:
    - container: container
      image: registry.access.redhat.com/ubi8/toolbox:8.8
      options: --user=0 --privileged -v /dev/shm:/dev/shm --device /dev/net/tun --name vpn

# Azure DevOps Pipeline running e2e tests
variables:
  - template: vars.yml

# Run the test suite and collect must-gather
jobs:
  - job:
    timeoutInMinutes: 30
    pool:
      name: 1es-aro-ci-pool
    steps:
      - template: ./templates/template-checkout.yml

      - template: ./templates/template-az-cli-login.yml
        parameters:
          azureDevOpsJSONSPN: $(aro-v4-e2e-devops-spn)

      - script: |
          set -e
          # retrieve the oc cli
          wget -nv https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/$(OpenShiftCLIVersion)/openshift-client-linux-$(OpenShiftCLIVersion).tar.gz
          tar xf openshift-client-linux-$(OpenShiftCLIVersion).tar.gz
          
          OCP_VERSION=4.14.37 OC=./oc make validate-roledef
        displayName: Run check
        target: container
